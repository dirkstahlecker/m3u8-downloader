 #! /usr/bin/env bash

videoPath=$1
#videoPath=https://damb2tknfsomm.cloudfront.net/uploaded/JQLqNkmwzaMN7BLP1DOoLjZPzblJ9Y4W/1080p_5800k_v4.m3u8
audioPath=$2
#audioPath=https://damb2tknfsomm.cloudfront.net/uploaded/JQLqNkmwzaMN7BLP1DOoLjZPzblJ9Y4W/192k_audio_v4.m3u8

if [ $3 != "" ]; then
	outputPath=$3
else
	outputPath=output.mp4
fi


echo $videoPath
echo $audioPath
echo $outputPath

videoTempPath=video.mp4
audioTempPath=audio.ts


#get video
echo "getting video"
ffmpeg -i $videoPath -c copy video.mp4 > /dev/null 2>&1
wait
echo "got video"

#get audio
echo "getting audio"
ffmpeg -i $audioPath -c copy -map a audio.ts > /dev/null 2>&1
wait
echo "got audio"

#combine
echo "combining"
ffmpeg -i $videoTempPath -i $audioTempPath -c:v copy -c:a aac $outputPath > /dev/null 2>&1
wait
echo "finished"


#clean up
echo "cleaning up"
rm $videoTempPath
rm $audioTempPath

echo "done"